
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>PhytoOracle HPC Setup Guide &#8212; PhytoOracle 1.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="phytooracle-hpc-setup-guide">
<h1>PhytoOracle HPC Setup Guide<a class="headerlink" href="#phytooracle-hpc-setup-guide" title="Permalink to this headline">¶</a></h1>
<p>This guide will walk you through the necessary steps required to launch PhytoOracle’s pipelines onto a High Performance Computer system using interactive nodes (as tested on the University of Arizona’s HPC).</p>
<p>PhytoOracle’s repositories will be downloaded on the interactive node which will act as the Master, and jobs will be distributed to the Workers nodes using pbs scripts.</p>
<p><strong>Required Software</strong></p>
<p>Look at documentation from your HPC provider, ensure that the HPC is running CentOS 7 and has these software installed:</p>
<ul class="simple">
<li><p>Python 3 (tested with python v 3.8)</p></li>
<li><p>Singularity (tested with singularity v 3.5.3)</p></li>
<li><p>[CCTools](<a class="reference external" href="https://ccl.cse.nd.edu/software/downloadfiles.php">https://ccl.cse.nd.edu/software/downloadfiles.php</a>) (tested with CCTools v 7.0.19)</p></li>
<li><p>iRODS (tested with iRODS v 4.2.7)</p></li>
<li><p>Git (tested with Git v 1.7.1)</p></li>
</ul>
<p>CCTools is avaialbe to install and run without root permissions. Dowload and store CCTools in your <cite>home</cite> directory; if Python3, Singularity, iRODS, Git are not installed, please contact your HPC provider.</p>
<p><strong>Launching an interactive node and accessing PhytoOracle</strong></p>
<p>To launch an interactive node, do:</p>
<p>replace <cite>&lt;your_group_list&gt;, &lt;priority&gt;, &lt;CPU_#&gt;, &lt;RAM_#&gt;, &lt;max_hour_#&gt;</cite> with your preferred settings.</p>
<p>When the interactive node is done loading, clone the PhytoOracle repository with</p>
<p><cite>cd</cite> (change directory) to your required pipeline, and you’re done!</p>
<p>Before proceeding, notice that your interactive node has an address: is the number before the <cite>$</cite>; it will be required when launching workers.</p>
<p><strong>Launching Workers</strong></p>
<p>To launch workers, you use a <cite>.pbs</cite> script. Using your preferred editor, create a <cite>.pbs</cite> script and paste the following lines:</p>
<p>As before, change the highlighted <cite>&lt;fields&gt;</cite> to preferred settings. Save your changes and submit with</p>
<p>Depending on the traffic on the HPC and on the set priorities, wait for workers to become avaialbe before launch.</p>
<p>A working example on the University of Arizona’s HPC runinng the FliIr pipeline is</p>
<p>Your setup on the <em>HPC</em> is now complete! Please go to the pipeline of your choice to continue with running and processing.</p>
<p><strong>Manual Installation</strong></p>
<p>Below are the instructions for installation of CCTools and Singularity on Jetsream or other cloud platforms.</p>
<p><strong>CCTools (7.0.21)</strong></p>
<ul class="simple">
<li><p>You can install the dependency for compile from source (Ubuntu 18.04 LTS) [here](<a class="reference external" href="https://jxuzy.blogspot.com/2019/11/install-cctools-ubuntu-1804lts.html">https://jxuzy.blogspot.com/2019/11/install-cctools-ubuntu-1804lts.html</a>):</p></li>
<li><p>These commands will compile and install cctools (version 7.0.21) to <cite>/usr/bin</cite>, so that they are in the <cite>$PATH</cite>.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wget http://ccl.cse.nd.edu/software/files/cctools-7.0.21-source.tar.gz
tar -xvf cctools-7.0.21-source.tar.gz
cd cctools-release-7.0.21
./configure --prefix /usr
make -j$(nproc)
sudo make install
</pre></div>
</div>
<p><strong>Singularity 3.5.1</strong> (recommended)</p>
<ul class="simple">
<li><p>Install dependencies for singularity</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo apt-get update &amp;&amp; sudo apt-get install -y \
build-essential \
libssl-dev \
uuid-dev \
libgpgme11-dev \
squashfs-tools \
libseccomp-dev \
wget \
pkg-config \
git \
cryptsetup

wget https://dl.google.com/go/go1.13.5.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.13.5.linux-amd64.tar.gz
echo &quot;export PATH=\$PATH:/usr/local/go/bin&quot; | sudo tee -a /etc/profile
export PATH=$PATH:/usr/local/go/bin
</pre></div>
</div>
<ul class="simple">
<li><p>Build singularity</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sylabs</span><span class="o">/</span><span class="n">singularity</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v3</span><span class="o">.</span><span class="mf">5.1</span><span class="o">/</span><span class="n">singularity</span><span class="o">-</span><span class="mf">3.5</span><span class="o">.</span><span class="mf">1.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">singularity</span><span class="o">-</span><span class="mf">3.5</span><span class="o">.</span><span class="mf">1.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">singularity</span>
<span class="o">./</span><span class="n">mconfig</span> <span class="o">&amp;&amp;</span> \
<span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">builddir</span> <span class="o">&amp;&amp;</span> \
<span class="n">sudo</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">builddir</span> <span class="n">install</span>
</pre></div>
</div>
<p><strong>Connecting to CyVerse Data Store</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iinit</span>    <span class="c1"># initialize irods with your account</span>

<span class="s2">&quot;irods_host&quot;</span><span class="p">:</span> <span class="s2">&quot;data.cyverse.org&quot;</span><span class="p">,</span>
<span class="s2">&quot;irods_port&quot;</span><span class="p">:</span> <span class="mi">1247</span><span class="p">,</span>
<span class="s2">&quot;irods_user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span>
<span class="s2">&quot;irods_zone_name&quot;</span><span class="p">:</span> <span class="s2">&quot;iplant&quot;</span>
</pre></div>
</div>
<p>Read more about <a class="reference external" href="https://wiki.cyverse.org/wiki/display/DS/Using+iCommands">Using icommands</a> here.</p>
<p><strong>Known Issues &amp; Caveats</strong></p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Known Issues</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Issue</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Fix</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Corrupted Singularity image</p></td>
<td><p>Happens when multiple worker try to pull into the same default location</p></td>
<td><p>Pull Singularity containers manually onto each worker before execution</p></td>
</tr>
<tr class="row-odd"><td><p>Kernel too old</p></td>
<td><p>happens due to incompatibility to run singularity containers</p></td>
<td><p>Rebuild container using an older base image</p></td>
</tr>
<tr class="row-even"><td><p>Disk space</p></td>
<td><p>VM need to have space stage the whole data sets</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Workers not connecting to Masters</p></td>
<td><p>too frequent network IO</p></td>
<td><p>HTTP server move away the transfer of input files from Makeflow</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td><p>Bundling jobs reduces the number/frequency of network IO for returning result</p></td>
</tr>
<tr class="row-odd"><td><p>Makeflow -T local as a job/rule does not work</p></td>
<td><p>“could” be missing implict dependency</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">PhytoOracle</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Michele Cosi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/old_docs/setup.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>